{% extends 'base.html.twig' %}

{% block title %}Dossiers du Placard - {{ placard.name }}{% endblock %}

{% block body %}
<div class="container-fluid">
    <!-- En-tête simple -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-folder me-2"></i>
                        Dossiers du Placard: {{ placard.name }}
                    </h2>
                    <p class="text-muted mb-0">
                        <i class="fas fa-map-marker-alt me-1"></i>{{ placard.location }} • 
                        Créé le {{ placard.createdAt|date('d/m/Y') }}
                    </p>
                </div>
                <a href="{{ path('responsable_manage_placards') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Retour
                </a>
            </div>
        </div>
    </div>

    {% if placard.dossiers is not empty %}
    <!-- Barre de recherche simple -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fas fa-search"></i>
                </span>
                <input type="text" class="form-control" id="searchInput" placeholder="Rechercher un dossier...">
                <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="col-md-6 text-end">
            <span class="badge bg-secondary fs-6">
                {{ placard.dossiers|length }} dossier{{ placard.dossiers|length > 1 ? 's' : '' }}
            </span>
        </div>
    </div>

    <!-- Liste des dossiers en tableau -->
    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Nom du Dossier</th>
                            <th>Employé</th>
                            <th>Emplacement</th>
                            <th>Statut</th>
                            <th>Documents</th>
                            <th>Créé le</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dossiersContainer">
                        {% for dossier in placard.dossiers %}
                        <tr class="dossier-row">
                            <td>
                                <i class="fas fa-folder me-2 text-primary"></i>
                                <strong>{{ dossier.nom }}</strong>
                            </td>
                            <td>
                                <i class="fas fa-user me-1 text-muted"></i>
                                {{ dossier.employe.prenom }} {{ dossier.employe.nom }}
                            </td>
                            <td>
                                {% if dossier.emplacement %}
                                    <i class="fas fa-map-marker-alt me-1 text-muted"></i>
                                    <strong>{{ dossier.emplacement }}</strong>
                                {% else %}
                                    <span class="text-muted">Non défini</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if dossier.status == 'completed' %}
                                    <span class="badge bg-success">Complet</span>
                                {% elseif dossier.status == 'in_progress' %}
                                    <span class="badge bg-warning">En cours</span>
                                {% else %}
                                    <span class="badge bg-secondary">En attente</span>
                                {% endif %}
                            </td>
                            <td>
                                <i class="fas fa-file-alt me-1 text-muted"></i>
                                {{ dossier.documents|length }}
                            </td>
                            <td>
                                <i class="fas fa-calendar me-1 text-muted"></i>
                                {{ dossier.createdAt|date('d/m/Y') }}
                            </td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm">
                                    <a href="{{ path('responsable_view_dossier_documents', {'id': dossier.id}) }}" 
                                       class="btn btn-outline-primary">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ path('responsable_edit_dossier', {'id': dossier.id}) }}" 
                                       class="btn btn-outline-secondary">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <!-- État vide simple -->
    <div class="card">
        <div class="card-body text-center py-5">
            <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">Aucun dossier</h4>
            <p class="text-muted mb-3">Ce placard ne contient aucun dossier pour le moment.</p>
            <a href="{{ path('responsable_manage_dossiers') }}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Créer un Dossier
            </a>
        </div>
    </div>
    {% endif %}
</div>

<script>
    // Fonctionnalité de recherche
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const clearButton = document.getElementById('clearSearch');
        const dossierRows = document.querySelectorAll('.dossier-row');

        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                let visibleCount = 0;

                dossierRows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                        visibleCount++;
                    } else {
                        row.style.display = 'none';
                    }
                });

                // Mettre à jour le compteur
                const counter = document.querySelector('.badge.bg-secondary');
                if (counter) {
                    counter.textContent = `${visibleCount} dossier${visibleCount > 1 ? 's' : ''}`;
                }
            });
        }

        if (clearButton) {
            clearButton.addEventListener('click', function() {
                searchInput.value = '';
                dossierRows.forEach(row => {
                    row.style.display = '';
                });
                searchInput.focus();
                
                // Remettre le compteur original
                const counter = document.querySelector('.badge.bg-secondary');
                if (counter) {
                    counter.textContent = '{{ placard.dossiers|length }} dossier{{ placard.dossiers|length > 1 ? "s" : "" }}';
                }
            });
        }
    });
</script>

<style>
    @media (max-width: 767px) {
        h2 {
            font-size: 1.25rem !important;
        }
        
        .d-flex.justify-content-between {
            flex-direction: column;
            gap: 1rem;
        }
        
        .btn {
            width: 100%;
        }
        
        .col-md-6.text-end {
            text-align: left !important;
            margin-top: 0.5rem;
        }
        
        .table {
            font-size: 0.85rem;
        }
        
        .table th,
        .table td {
            padding: 0.5rem !important;
        }
        
        .badge {
            font-size: 0.75rem !important;
        }
        
        .btn-sm {
            font-size: 0.75rem !important;
            padding: 0.25rem 0.5rem !important;
        }
    }
</style>
{% endblock %}

